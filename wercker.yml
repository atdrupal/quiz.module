box: wercker/php
services:
    - wercker/mysql
build:
    steps:
    -  script:
          name: Install Drush
          code: |-
              export PATH="$HOME/.composer/vendor/bin:$PATH"
              composer global require drush/drush:dev-master
    -  script:
          name: Install Drupal
          code: |-
              drush site-install testing --db-url=$WERCKER_MYSQL_URL --yes
    -  script:
          name: Enable modules
          code: |-
              drush en --yes simpletest long_answer matching multichoice quiz_ddlines quiz_directions quiz_page quiz_question scale short_answer truefalse
              drush vset --yes simpletest_verbose FALSE
    -  script:
          name: Start server
          code: |-
              drush cc all
              drush runserver --server=builtin 8888 & sleep 3
    -  script:
          name: Run tests
          code: |-
              drush test-run --dirty --field-labels=0 'Quiz' --uri=http://127.0.0.1:8888
